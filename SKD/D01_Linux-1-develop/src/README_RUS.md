# Операционные системы UNIX/Linux (Базовый).

Установка и обновления системы Linux. Основы администрирования.


## Contents
1. [Chapter I](#chapter-i)
2. [Chapter II](#chapter-ii) \
    2.1. [Linux](#linux)  
    2.2. [Администрирование](#администрирование)  
    2.3. [Виртуальные машины](#виртуальные-машины) 
3. [Chapter III](#chapter-iii) \
    3.1 [Установка ОС](#part-1-установка-ос)  
    3.2 [Создание пользователя](#part-2-создание-пользователя)  
    3.3 [Настройка сети ОС](#part-3-настройка-сети-ос)   
    3.4 [Обновление ОС](#part-4-обновление-ос)  
    3.5 [Использование команды  sudo](#part-5-использование-команды-sudo)  
    3.6 [Установка и настройка службы времени](#part-6-установка-и-настройка-службы-времени)  
    3.7 [Установка и использование текстовых редакторов](#part-7-установка-и-использование-текстовых-редакторов)  
    3.8 [Установка и базовая настройка сервиса SSHD](#part-8-установка-и-базовая-настройка-сервиса-sshd)   
    3.9 [Установка и использование утилит top, htop](#part-9-установка-и-использование-утилит-top-htop)   
    3.10 [Использование утилиты fdisk](#part-10-использование-утилиты-fdisk)   
    3.11 [Использование утилиты df](#part-11-использование-утилиты-df)    
    3.12 [Использование утилиты du](#part-12-использование-утилиты-du)    
    3.13 [Установка и использование утилиты ncdu](#part-13-установка-и-использование-утилиты-ncdu)    
    3.14 [Работа с системными журналами](#part-14-работа-с-системными-журналами)     
    3.15 [Использование планировщика заданий CRON](#part-15-использование-планировщика-заданий-cron)    


## Chapter I



## Part 1. Установка ОС

**== Задание ==**

##### Установи **Ubuntu 20.04 Server LTS** без графического интерфейса. (Используем программу для виртуализации - VirtualBox)

- Графический интерфейс должен отсутствовать.

- Узнай версию Ubuntu, выполнив команду \
`cat /etc/issue.`
- Вставь скриншот с выводом команды.
- Выполнив команду cat /etc/issue., проверим версию установленной Ubuntu.

![проверка установленной ubuntu](src/img/01.png)

## Part 2. Создание пользователя

**== Задание ==**

##### Создай пользователя, отличного от созданного при установке. Пользователь должен быть добавлен в группу `adm`.

- Вставь скриншот вызова команды для создания пользователя.
- Новый пользователь должен быть в выводе команды \
`cat /etc/passwd`
- Вставь скриншот с выводом команды.

**== Выполнение задания ==**
- Создадим нового пользователя yerzhan с помощью команды sudo adduser yerzhan

![создание нового пользователя](src/img/02.png)

- При выводе команды cat /etc/passwd новый пользователь yerzhan также отображается.

![новый пользователь](src/img/03.png)

- Добавим пользователя yerzhan в группу adm (sudo usermod -aG adm yerzhan) и проверим группы пользователя с помощью команды groups.

![новый пользователь в группе adm](src/img/04.png)

## Part 3. Настройка сети ОС


**== Задание ==**

##### Задай название машины вида user-1.
##### Установи временную зону, соответствующую твоему текущему местоположению.  
##### Выведи названия сетевых интерфейсов с помощью консольной команды.
- В отчёте дай объяснение наличию интерфейса lo.  
##### Используя консольную команду, получи ip адрес устройства, на котором ты работаешь, от DHCP сервера. 
- В отчёте дай расшифровку DHCP.  
##### Определи и выведи на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw). 
##### Задай статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (используй публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).  
##### Перезагрузи виртуальную машину. Убедись, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.  

- В отчёте опиши, что сделал для выполнения всех семи пунктов (можно как текстом, так и скриншотами).
- Успешно пропингуй удаленные хосты 1.1.1.1 и ya.ru и вставь в отчёт скрин с выводом команды. В выводе команды должна быть фраза «0% packet loss».

**== Выполнение задания ==**

- При вызове команды hostname отображается имя yonnrose, заданное при установке ОС. С помощью команды sudo hostnamectl set-hostname user-1 название машины изменена на user-1. При повторном вызове hostname получаем новое название - user-1, что и показано на скриншоте.

![задаем название машины вида user-1](src/img/05.png)

- После выполнения sudo reboot изменения сохранятся и название машины будет отображаться, как user-1.

![reboot](src/img/06.png)

_____


- Далее, проверим текущюю временную зону. Как можно увидеть, она не соответствует текущему местоположению.

![date](src/img/07.png)

- Установим временную зону для это запустим команду timedatectl list-timezones для просмотра доступных временных зон. Найдем нужную временную зону для Узбекистана. Например, для Самарканда это будет Asia/Samarkand. Установим временную зону командой: sudo timedatectl set-timezone Asia/Samarkand и выполним проверку.

![date](src/img/08.png)
________


- Выведем названия сетевых интерфейсов с помощью консольной команды ip list show или ip address.

![ip address](src/img/09.png)

  Интерфейс lo (Loopback) является виртуальным сетевым интерфейсом, предназначенным для обратной связи в пределах компьютера. Он представляет собой специальный интерфейс, который отправляет пакеты обратно на тот же компьютер без фактической передачи их через физическую сеть. Этот интерфейс часто используется для тестирования сетевых приложений и сервисов, а также для маршрутизации пакетов в пределах самого устройства.

________

- Чтобы получить IP-адрес устройства, полученный от DHCP сервера, используем команду ip следующим образом: ip addr show. Как видно на скриншоте, DHCP выдал устройству ip адрес 10.0.2.15/24

![ip address](src/img/10.png)

  DHCP – Dynamic Host Configuration Protocol (протокол динамической конфигурации хоста). Это механизм динамической выдачи IP-адресов в сети. IP-адрес (Internet Protocol) - способ адрессации устройств по сети. У каждого устройства свой уникальный ip-адрес. Без DHCP-сервера, администратору пришлось бы вручную настраивать статический IP-адрес каждого устройства, что при большом количестве устройст могло бы привести к ошибке.

_____

- Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw).
  Шлюз - это один из типов маршрутизаторов. Маршрутизаторы соединяют несколько сетей и выполняют функции маршрутизации пакетов. Шлюзы осуществляют маршрутизацию на сетевом уровне.

- Один из способов узнать внешний ip-адрес устройства - это команда curl ipecho.net. 

![ip address](src/img/11.png)

- Также можно с помощью curl ifconfig.co.

![ip address](src/img/12.png)

- внутренний ip-адрес можно узнать следующим способом: hostname -I

![ip address](src/img/13.png)

  == В чем разница между внутренним и внешним ip-адресами шлюза? ==
  Как внешний, так и внутренний ip-адреса предназначены для одной цели, но разница в области видимости. Внешний адрес шлюза используется по всему Интернету, когда внутренний используется только в приватной сети к устройстам, подключенным к ней.

- Зададим статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовав публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).
- Протокол DHCP автоматически присваивает устройству IP. 
- Затем перейдем к файлу конфигурации Netplan. В данном случае это файл 00-installer-config.yaml.

- Откроем файл в текстовом редакторе nano с помощью команды sudo nano /etc/netplan/00-installer-config.yaml.
- Зададим статические настройки.

![ip address](src/img/14.png)

- Для применения изменений используем команду netplan apply

- Перезагружаем виртуальную машину командой reboot

______________

- Успешно пропинговать удаленные хосты 1.1.1.1 и ya.ru и вставить в отчёт скрин с выводом команды. В выводе команды должна быть фраза "0% packet loss".

![ip address](src/img/15.png)

  Ping — утилита для проверки целостности и качества соединений в сетях. Утилита отправляет запросы указанному узлу сети и фиксирует поступающие ответы. Время между отправкой запроса и получением ответа позволяет определять двусторонние задержки по маршруту и частоту потери пакетов, то есть косвенно определять загруженность на каналах передачи данных и промежуточных устройствах.

## Part 4. Обновление ОС


**== Задание ==**

##### Обнови системные пакеты до последней на момент выполнения задания версии.  

- После обновления системных пакетов, если ввести команду обновления повторно, должно появиться сообщение, что обновления отсутствуют;
- Вставь скриншот с этим сообщением в отчёт.

**== Выполнение задания ==**

Выполним sudo apt update и sudo apt upgrade
Повторно вызовем команды и получим сообщение об отсутствии новых обновлений.

![ip address](src/img/16.png)

## Part 5. Использование команды **sudo**

**== Задание ==**

##### Разреши пользователю, созданному в [Part 2](#part-2-создание-пользователя),выполнять команду sudo.

- В отчёте объясни *истинное* назначение команды sudo (про то, что это слово - «волшебное», писать не стоит);  
- Поменяй hostname ОС от имени пользователя, созданного в пункте [Part 2](#part-2-создание-пользователя) (используя sudo);
- Вставь скрин с изменённым hostname в отчёт.

**== Выполнение задания ==**

- Назначение команды sudo
  Команда sudo - substitute user and do, подменить пользователя и выполнить. Главное назначение sudo — это выполнить команду от имени другого пользователя, обычно от root. Смысл выполнения команды от root в том, что у него повышенные права доступа и, применяя sudo, обычный пользователь может выполнить те действия, на которые у него недостаточно прав.

- Сперва убедимся, что у пользователя yerzhan отсутствуют права sudo.

![ip address](src/img/17.png)

- Наделим пользователя правами sudo.

![ip address](src/img/18.png)

- Сменим пользователя на yerzhan.

![ip address](src/img/19.png)

- Выполним изменение названия машины и проверку сохранения изменений. 

![ip address](src/img/20.png)

- После этого вызовем reboot.

![ip address](src/img/21.png)

## Part 6. Установка и настройка службы времени

**== Задание ==**

##### Настрой службу автоматической синхронизации времени.  

- Выведи время часового пояса, в котором ты сейчас находишься.
- Вывод следующей команды должен содержать `NTPSynchronized=yes`: \
  `timedatectl show`
- Вставь скрины с корректным временем и выводом команды в отчёт.

**== Выполнение задания ==**

- Настройки часового пояса.

![ip address](src/img/22.png)

## Part 7. Установка и использование текстовых редакторов 


**== Задание ==**

##### Установи текстовые редакторы **VIM** (+ любые два по желанию **NANO**, **MCEDIT**, **JOE** и т.д.)  
##### Используя каждый из трех выбранных редакторов, создай файл *test_X.txt*, где X -- название редактора, в котором создан файл. Напиши в нём свой никнейм, закрой файл с сохранением изменений.  
- В отчёт вставь скриншоты:
  - Из каждого редактора с содержимым файла перед закрытием;
- В отчёте укажи, что сделал для выхода с сохранением изменений.
##### Используя каждый из трех выбранных редакторов, открой файл на редактирование, отредактируй файл, заменив никнейм на строку «21 School 21», закрой файл без сохранения изменений.
- В отчёт вставь скриншоты:
    - Из каждого редактора с содержимым файла после редактирования;
- В отчёте укажи, что сделал для выхода без сохранения изменений.
##### Используя каждый из трех выбранных редакторов, отредактируй файл ещё раз (по аналогии с предыдущим пунктом), а затем освой функции поиска по содержимому файла (слово) и замены слова на любое другое.
- В отчёт вставь скриншоты:
    - Из каждого редактора с результатами поиска слова;
    - Из каждого редактора с командами, введёнными для замены слова на другое.

**== Выполнение задания ==**

- Установка текстовых редакторов.
- sudo apt install vim
- sudo apt install nano
- sudo apt install mcedit
### Запись никнейма в файлы и закрытие с сохранением
- VIM

![ip address](src/img/23.png)

Для выхода с сохранением нужно нажать Esc, затем написать :wq, что означает write and quit.

- NANO

![ip address](src/img/24.png)

Для выхода с сохранением нужно выполнить Ctrl+S и Ctrl+X

- MCEDIT

![ip address](src/img/25.png)

Для выхода с сохранением необходимо нажать F10 и выбрать yes.

![ip address](src/img/26.png)

______

### Запись текста "21 School 21" в файлы и выход без сохранения
- VIM

![ip address](src/img/27.png)

Для выхода без сохранения нужно нажать Esc, затем написать :q!. Проверим, что изменения не сохранились.

![ip address](src/img/28.png)

- NANO

![ip address](src/img/29.png)

Для выхода без сохранения нужно нажать Esc, затем Ctrl + X. Проверим, что изменения не сохранились.

![ip address](src/img/30.png)

- MCEDIT

![ip address](src/img/31.png)

Для выхода без сохранения нужно нажать F10, затем выбрать No.

![ip address](src/img/32.png)

Проверим, что изменения не сохранились.

![ip address](src/img/33.png)

_________

### Поиск по слову в файлах
Внесем те же изменения, что и в прошлом пункте, но сохраним файлы.

- VIM
  Поиск:
  Esc + /<word_to_search>

![ip address](src/img/34.png)

  Замена:
:%s/<change_this>/<to_this>

![ip address](src/img/35.png)

- NANO
  Поиск:
  Ctrl + W

![ip address](src/img/36.png)

Замена:
Ctrl + \

![ip address](src/img/37.png)

![ip address](src/img/38.png)

![ip address](src/img/39.png)

- MCEDIT 
  Поиск:
  F7

![ip address](src/img/40.png)

![ip address](src/img/41.png)

  Замена:
  F4

![ip address](src/img/42.png)

![ip address](src/img/43.png)
_______


## Part 8. Установка и базовая настройка сервиса **SSHD**


**== Задание ==**

##### Установи службу SSHd.  
##### Добавь автостарт службы при загрузке системы.  
##### Перенастрой службу SSHd на порт 2022.  
##### Используя команду ps, покажи наличие процесса sshd. Для этого к команде нужно подобрать ключи.
- В отчёте объясни значение команды и каждого ключа в ней.
##### Перезагрузи систему.
- В отчёте опиши, что сделал для выполнения всех пяти пунктов (можно как текстом, так и скриншотами).
- Вывод команды netstat -tan должен содержать  \
`tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN`  \
(если команды netstat нет, то ее нужно установить)
- Скрин с выводом команды вставь в отчёт.
- В отчёте объясни значение ключей -tan, значение каждого столбца вывода, значение 0.0.0.0.

**== Выполнение задания ==**

- Установим службу SSHd с помощью команды sudo apt install openssh-server.
- Автоматически SSHd автостарт службы добавлен при загрузке системы: sudo systemctl status ssh

![ip address](src/img/44.png)

- Изменить автостарт можно с помощью команд sudo systemctl disable ssh
- Перенастройка службы SSHd на порт 2022: sudo nano /etc/ssh/sshd_config

![ip address](src/img/45.png)

- В открывшемся файле строку Port 22 изменим ее на Port 2022. Сохраним изменения и закроем файл. 

![ip address](src/img/46.png)

- После этого перезапустим службу SSHd: sudo systemctl restart ssh
- Проверка наличия процесса sshd с использованием команды ps и ключей: ps -aux | grep sshd

![ip address](src/img/47.png)

  ps - это команда, которая выводит текущие процессы.
  -aux - это комбинация ключей, где:
  a - отображает процессы всех пользователей.
  u - выводит дополнительную информацию о каждом процессе.
  x - показывает процессы, не привязанные к текущему терминалу (т.е. процессы фоновых задач).
  grep sshd - это фильтр, который используется для поиска строк, содержащих "sshd" в выводе ps, чтобы отобразить только процессы, связанные с SSHd.

- Выполним reboot и netstat -tan

![ip address](src/img/48.png)

  netstat -tan
  Команда netstat показывает статистику приема и отправки пакетов, а также информацию об ошибках приема и отправки.
  -a - Вывод всех активных подключений TCP и прослушиваемых компьютером портов TCP и UDP.
  -n - Вывод активных подключений TCP с отображением адресов и номеров портов в числовом формате без попыток определения имен.
  Тогда, если netstat -na - просмотр всех открытых протоколов, то netstat -tan - просмотр всех открытых ТСР-протоколов.

  Значение ключей и столбцов в выводе:

  tcp - протокол транспортного уровня, в данном случае TCP.
  0 - индикатор использования протокола IPv4.
  0 - индикатор использования протокола IPv6.
  0.0.0.0:2022 - адрес и порт, на котором слушается соединение (в данном случае, все интерфейсы и порт 2022).
  0.0.0.0:* - адрес и порт, к которому привязано соединение.
  LISTEN - состояние соединения, ожидающего новых подключений.
  Значение 0.0.0.0 означает, что слушающий сокет связан со всеми доступными сетевыми интерфейсами.

## Part 9. Установка и использование утилит **top**, **htop**

**== Задание ==**

##### Установи и запусти утилиты top и htop.  

- По выводу команды top определи и напиши в отчёте:
  - uptime
  - количество авторизованных пользователей
  - общую загрузку системы
  - общее количество процессов
  - загрузку cpu
  - загрузку памяти
  - pid процесса занимающего больше всего памяти
  - pid процесса, занимающего больше всего процессорного времени
- В отчёт вставь скрин с выводом команды htop:
  - отсортированному по PID, PERCENT_CPU, PERCENT_MEM, TIME
  - отфильтрованному для процесса sshd
  - с процессом syslog, найденным, используя поиск 
  - с добавленным выводом hostname, clock и uptime  

**== Выполнение задания ==**

- Команда top выдает следующий результат:

![ip address](src/img/49.png)

- uptime: 25 min
  - (Uptime отображается в самом верху вывода команды top. Это время, прошедшее с момента последней загрузки системы.)
- количество авторизованных пользователей: 1.
  - (В колонке "users" указано количество авторизованных пользователей.)
- общая загрузка системы: 0.00
  - (В верхней части вывода команды top в строке "load average" отображается общая загрузка системы за последние 1, 5 и 15 минут.)
- общее количество процессов: 94
  - (В верхней части вывода команды top в строке "Tasks" отображается общее количество процессов.)
- загрузка cpu: 0.0%
  - (Загрузка процессора отображается в разделе "%Cpu(s)".)
- агрузка памяти: 137.6
  - (Использование памяти отображается в разделе "Mem", где показано общее количество памяти, используемой, свободной, в буферах и т.д.)
- pid процесса занимающего больше всего памяти: 1
  - (В разделе "PID USER" отображается PID процесса, занимающего больше всего памяти.)
- pid процесса, занимающего больше всего процессорного времени: 1146
  - (В разделе "PID USER" отображается PID процесса, который занимает больше всего процессорного времени.)

- htop
  - htop, отсортированный по PID

![ip address](src/img/50.png)

- htop, отсортированный по PERCENT_CPU

![ip address](src/img/51.png)

- htop, отсортированный по PERCENT_MEM

![ip address](src/img/52.png)

- htop, отсортированный по TIME

![ip address](src/img/53.png)

- htop, отфильтрованный для процесса sshd

![ip address](src/img/54.png)

- htop с процессом syslog, найденным, используя поиск

![ip address](src/img/55.png)

- htop с добавленным выводом hostname, clock и uptime

![ip address](src/img/56.png)

## Part 10. Использование утилиты **fdisk**


**== Задание ==**

##### Запусти команду fdisk -l.

- В отчёте напиши название жесткого диска, его размер и количество секторов, а также размер swap.

**== Выполнение задания ==**

![ip address](src/img/57.png)

![ip address](src/img/58.png)

- Название диска: VBOX HARDDISK
- Размер диска: 10 Гигабайт
- Количество секторов: 20971520
- Размер swap: 0 байт

## Part 11. Использование утилиты **df** 


**== Задание ==**

##### Запусти команду df.  
- В отчёте напиши для корневого раздела (/):
  - размер раздела
  - размер занятого пространства
  - размер свободного пространства
  - процент использования
- Определи и напиши в отчёт единицу измерения в выводе.  

##### Запусти команду df -Th.
- В отчёте напиши для корневого раздела (/):
    - размер раздела
    - размер занятого пространства
    - размер свободного пространства
    - процент использования
- Определи и напиши в отчёт тип файловой системы для раздела.

**== Выполнение задания ==**

- df

![ip address](src/img/59.png)

для корневого раздела (/):
- размер раздела - 8408452
- размер занятого пространства - 3087376
- размер свободного пространства - 4872360
- процент использования 39%
- единица измерения - Килобайт.

- df -Th

![ip address](src/img/60.png)

для корневого раздела (/):
- размер раздела - 8.1
- размер занятого пространства - 3.0
- размер свободного пространства - 4.7
- процент использования 39%
- единица измерения - Гб.
- тип файловой системы для раздела - ext4

## Part 12. Использование утилиты **du**


**== Задание ==**

##### Запусти команду du
##### Выведи размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде)
##### Выведи размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)

- В отчёт вставь скрины с выводом всех использованных команд.

**== Выполнение задания ==**

- du

![ip address](src/img/61.png)

размер папок /home в байтах и человекочитаемом виде.

![ip address](src/img/62.png)

размер папок /var в байтах и человекочитаемом виде.

![ip address](src/img/63.png)

размер папок /var/log в байтах и человекочитаемом виде.

![ip address](src/img/64.png)

размер всего содержимого в /var/log.

![ip address](src/img/65.png)

## Part 13. Установка и использование утилиты **ncdu**

**== Задание ==**

##### Установи утилиту ncdu
##### Выведи размер папок /home, /var, /var/log

- Размеры должны примерно совпадать с полученными в [Part 12](#part-12-использование-утилиты-du).

- В отчёт вставь скрины с выводом использованных команд.

**== Выполнение задания ==**

- /home

![ip address](src/img/66.png)

- /var

![ip address](src/img/67.png)

- /var/log

![ip address](src/img/68.png)

## Part 14. Работа с системными журналами


**== Задание ==**

##### Открой для просмотра:
##### 1. /var/log/dmesg
##### 2. /var/log/syslog
##### 3. /var/log/auth.log  

- Напиши в отчёте время последней успешной авторизации, имя пользователя и метод входа в систему;
- Перезапусти службу SSHd;
- Вставь в отчёт скрин с сообщением о рестарте службы (искать в логах).

**== Выполнение задания ==**

- /var/log/dmesg
  - /var/log/dmesg — драйвера устройств. Одноименной командой можно просмотреть вывод содержимого файла. Размер журнала ограничен, когда файл достигнет своего предела, старые сообщения будут перезаписаны более новыми.

![ip address](src/img/69.png)

- /var/log/syslog
  - /var/log/syslog содержит глобальный системный журнал, в котором пишутся сообщения с момента запуска системы, от ядра Linux, различных служб, обнаруженных устройствах, сетевых интерфейсов и много другого.

![ip address](src/img/70.png)

- /var/log/auth.log
  - var/log/auth.log — информация об авторизации пользователей, включая удачные и неудачные попытки входа в систему, а также задействованные механизмы аутентификации.

![ip address](src/img/71.png)

  последня успешная авторизация: May 10 17:17:01

  имя пользователя: yonnrose

  метод входа в систему: by uid = 0 (User Identifier). Суперпользователь всегда должен иметь UID, равный нулю (0).

- Перезапуск службу SSHd. systemctl restart ssh

скрин с сообщением о рестарте службы:

![ip address](src/img/72.png)

## Part 15. Использование планировщика заданий **CRON**


**== Задание ==**

##### Используя планировщик заданий, запусти команду uptime через каждые 2 минуты.
- Найди в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении;
- Выведи на экран список текущих заданий для CRON;
- Вставь в отчёт скрины со строчками о выполнении и списком текущих задач.

##### Удали все задания из планировщика заданий.
- В отчёт вставь скрин со списком текущих заданий для CRON.

**== Выполнение задания ==**

- crontab -e

![ip address](src/img/73.png)

- crontab -l

![ip address](src/img/74.png)

- uptime каждые 2 минуты:

![ip address](src/img/75.png)

- crontab -r

![ip address](src/img/76.png)